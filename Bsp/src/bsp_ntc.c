#include "sys_type.h"
#include "n32l40x.h"
#include "bsp_ntc.h"



const ULONG ulADC_TH_R_DATA[] =   /* NTC Resistor Value */
{
     //NTSE0103FZJ331
    857,    //105
    879,    //104
    901,    //103
    924,    //102
    948,    //101
    973,    //100
    998,    //99
    1024,   //98
    1051,   //97
    1079,   //96
    1108,   //95
    1138,   //94
    1168,   //93
    1200,   //92
    1232,   //91
    1266,   //90
    1301,   //89
    1337,   //88
    1374,   //87
    1412,   //86
    1451,   //85
    1492,   //84
    1534,   //83
    1578,   //82
    1623,   //81
    1669,   //80
    1717,   //79
    1767,   //78
    1818,   //77
    1871,   //76
    1926,   //75
    1982,   //74,
    2041,   //73
    2101,   //72
    2164,   //71
    2229,   //70
    2296,   //69
    2366,   //68
    2438,   //67
    2512,   //66
    2589,   //65
    2669,   //64
    2752,   //63
    2838,   //62
    2926,   //61
    3019,   //60
    3114,   //59
    3213,   //58
    3316,   //57
    3422,   //56
    3533,   //55
    3648,   //54
    3767,   //53
    3891,   //52
    4019,   //51
    4152,   //50
    4291,   //49
    4435,   //48
    4585,   //47
    4741,   //46
    4902,   //45
    5071,   //44
    5246,   //43
    5428,   //42
    5618,   //41
    5815,   //40
    6021,   //39
    6235,   //38
    6458,   //37
    6690,   //36
    6932,   //35
    7184,   //34
    7447,   //33
    7721,   //32
    8007,   //31
    8305,   //30
    8616,   //29
    8940,   //28
    9278,   //27
    9632,   //26
    10000,   //25
    10385,   //24
    10786,   //23
    11206,   //22
    11644,   //21
    12101,   //20
    12579,   //19
    13078,   //18
    13600,   //17
    14146,   //16
    14716,   //15
    15312,   //14
    15936,   //13
    16588,   //12
    17271,   //11
    17986,   //10
    18733,   //9
    19517,   //8
    20337,   //7
    21196,   //6
    22097,   //5
    23041,   // 4  
    24032,   // 3
    25070,   // 2
    26161,   // 1
    27305,   // 0
    28508,   //-1
    29771,   //-2
    31098,   //-3
    32495,   //-4
    33963,   //-5
    35509,   //-6
    37316,   //-7
    38850,   //-8
    40655,   //-9
    42558,   //-10
    44564,   //-11
    46680,   //-12
    48912,   //-13
    51267,   //-14
    53752,   //-15
    56376,   //-16
    59146,   //-17
    62072,   //-18
    65166,   //-19
    68424,   //-20
    71871,   //-21
    75511,   //-22
    79358,   //-23
    83422,   //-24
    87717,   //-25
    92258,   //-26
    97058,   //-27
    102136,   //-28
    107511,   //-29
    113203,   //-30
    119234,   //-31
    125631,   //-32
    133422,   //-33
    139635,   //-34
    147302,   //-35
    155454,   //-36
    164116,   //-37
    173310,   //-38
    183037,   //-39
    193278   //-40
};

const SHORT nADC_AIN_TEMP[] = 
{
    //NTSE0103FZJ331
    1050,        // 105
    1040,        // 104
    1030,        // 103
    1020,        // 102
    1010,        // 101
    1000,        // 100
    990,        //  99
    980,        //  98
    970,        //  97
    960,        //  96
    950,        //  95
    940,        //  94
    930,        //  93
    920,        //  92
    910,        //  91
    900,        //  90
    890,        //  89
    880,        //  88
    870,        //  87
    860,        //  86
    850,        //  85
    840,        //  84
    830,        //  83
    820,        //  82
    810,        //  81
    800,        //  80
    790,        //  79
    780,        //  78
    770,        //  77
    760,        //  76
    750,        //  75
    740,        //  74
    730,        //  73
    720,        //  72
    710,        //  71
    700,        //  70
    690,        //  69
    680,        //  68
    670,        //  67
    660,        //  66
    650,        //  65
    640,        //  64
    630,        //  63
    620,        //  62
    610,        //  61
    600,        //  60
    590,        //  59
    580,        //  58
    570,        //  57
    560,        //  56
    550,        //  55
    540,        //  54
    530,        //  53
    520,        //  52
    510,        //  51
    500,        //  50
    490,        //  49
    480,        //  48
    470,        //  47
    460,        //  46
    450,        //  45
    440,        //  44
    430,        //  43
    420,        //  42
    410,        //  41
    400,        //  40
    390,        //  39
    380,        //  38
    370,        //  37
    360,        //  36
    350,        //  35
    340,        //  34
    330,        //  33
    320,        //  32
    310,        //  31
    300,        //  30
    290,        //  29
    280,        //  28
    270,        //  27
    260,        //  26
    250,        //  25
    240,        //  24
    230,        //  23
    220,        //  22
    210,        //  21
    200,        //  20
    190,        //  19
    180,        //  18
    170,        //  17
    160,        //  16
    150,        //  15
    140,        //  14
    130,        //  13
    120,        //  12
    110,        //  11
    100,        //  10
    90,            //   9
    80,            //   8
    70,            //   7
    60,            //   6
    50,            //   5
    40,            //   4
    30,            //   3
    20,            //   2
    10,            //   1
    0,            //   0
    -10,        //  -1
    -20,        //  -2
    -30,        //  -3
    -40,        //  -4
    -50,        //  -5
    -60,        //  -6
    -70,        //  -7
    -80,        //  -8
    -90,        //  -9
    -100,        // -10
    -110,        // -11
    -120,        // -12
    -130,        // -13
    -140,        // -14
    -150,        // -15
    -160,        // -16
    -170,        // -17
    -180,        // -18
    -190,        // -19
    -200,        // -20
    -210,        // -21
    -220,        // -22
    -230,        // -23
    -240,        // -24
    -250,        // -25
    -260,        // -26
    -270,        // -27
    -280,        // -28
    -290,        // -29
    -300,        // -30
    -310,        // -31
    -320,        // -32
    -330,        // -33
    -340,        // -34
    -350,        // -35
    -360,        // -36
    -370,        // -37
    -380,        // -38
    -390,        // -39
    -400        // -40
};

UCHAR 	MATH_SearchIndex32( ULONG wk_input, const ULONG *wk_data, UCHAR wk_num )
{

    UCHAR	wk_index = 0;
    UCHAR	wk_cnt;
    UCHAR	wk_ascending_order;

    if( wk_num <= 2 ) 										
    {
        return ( 0 );
    }


    if( wk_data[0] <= wk_data[ wk_num - 1] ) 				
    {
        wk_ascending_order	= TRUE;
    }
    else 													
    {
        wk_ascending_order 	= FALSE;
    }

    /* Iindex serch */
    wk_data++;												
    for( wk_cnt = 1; wk_cnt < (UCHAR)( wk_num - 1 ); wk_cnt++ )
    {

        if( wk_ascending_order == TRUE ) 					
        {

            if( wk_input >= *wk_data++ )
            {
                wk_index++;
            }
        }
        else 												
        {

            if( wk_input < *wk_data++ )
            {
                wk_index++;
            }
        }
    }

    return ( wk_index );
}

SHORT MATH_LinearInterpolationNew( ULONG wk_input, const ULONG *wk_data1, const SHORT *wk_data2, UCHAR wk_limit )
{
    LONG	wk_calc1,	wk_calc2;
    UCHAR	wk_idx_low, wk_idx_hi;

    if( wk_limit == TRUE ) 														
    {

        if( wk_data1[0] <= wk_data1[1] ) 										
        {
            wk_idx_low	= 0;
            wk_idx_hi	= 1;
        }
        else  																
        {
            wk_idx_low	= 1;
            wk_idx_hi	= 0;
        }

        if( wk_input <= wk_data1[wk_idx_low] ) 									
        {
            return ( wk_data2[wk_idx_low] );
        }
        else if( wk_input >= wk_data1[wk_idx_hi] ) 									
        {
            return ( wk_data2[wk_idx_hi] );
        }
        else
        {
            ;	
        }

    }
    else
    {
        ;	
    }

    if( wk_data1[0] == wk_data1[1] )
    {

        wk_calc1	= wk_data2[0];

    }
    else
    {

        wk_calc1	= 	wk_data1[1] - wk_input;
        wk_calc1	*= 	wk_data2[0];

        wk_calc2	=	wk_input	- wk_data1[0];
        wk_calc2	*=	wk_data2[1];

        wk_calc1	+=	wk_calc2;							

        wk_calc2	=	wk_data1[1] - wk_data1[0];			

        wk_calc1	=	wk_calc1 / wk_calc2;
    }


    return (SHORT)( wk_calc1 );

}

SHORT nADC_Calc_TH( ULONG wk_adc_val )
{
    USHORT	wk_data;
    UCHAR	wk_index;

    if(wk_adc_val >= ulADC_TH_R_DATA[P_AIN_TEMP_TBL_MAX - 1])
    {
        wk_adc_val = nADC_AIN_TEMP[P_AIN_TEMP_TBL_MAX - 1];
    }
    else if(wk_adc_val <= ulADC_TH_R_DATA[0])
    {
        wk_adc_val = nADC_AIN_TEMP[0];
    }
    else
    {
        wk_index		= MATH_SearchIndex32( wk_adc_val, ulADC_TH_R_DATA, P_AIN_TEMP_TBL_MAX );
        wk_data 		= MATH_LinearInterpolationNew( wk_adc_val, &ulADC_TH_R_DATA[wk_index], &nADC_AIN_TEMP[wk_index], FALSE );
        wk_adc_val		= ( SHORT )wk_data;
    }

    return wk_adc_val;
}

